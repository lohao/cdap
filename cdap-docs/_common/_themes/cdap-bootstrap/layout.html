{#
    layout.html: extended for CDAP-bootstrap theme
    Assumes using Bootstrap version 3 or higher
#}
{% extends "layout-basic.html" %}

{% set bootstrap_version = "3.3.6" %}
{% set bs_span_prefix = "col-md-" %}

{% set theme_css_files = [
    '_static/bootstrap-' + bootstrap_version + '/css/bootstrap.min.css',
    '_static/bootstrap-' + bootstrap_version + '/css/bootstrap-theme.min.css',
    '_static/bootstrap-sphinx.css',
    '_static/cdap-dynamicscrollspy/cdap-dynamicscrollspy-4.css'
  ]
%}

{% if not theme_cdap_bootstrap_custom_css %}
  {% set theme_cdap_bootstrap_custom_css = [] %}
{% endif %}

{% set css_files = css_files + theme_css_files + theme_cdap_bootstrap_custom_css %}

{% set script_files = script_files + [
    '_static/js/jquery-1.11.0.min.js',
    '_static/js/jquery-fix.js',
    '_static/bootstrap-' + bootstrap_version + '/js/bootstrap.min.js',
    '_static/bootstrap-sphinx.js',
    '_static/cdap-dynamicscrollspy/cdap-dynamicscrollspy-4.js'
  ]
%}

{%- set render_sidebar = (not embedded) and (not theme_nosidebar|tobool) and sidebars %}

<!--
{%- set bs_content_width = render_sidebar and "9" or "12"%}
 -->
{%- set bs_content_width = render_sidebar and "8" or "12"%}

{%- block doctype -%}
<!DOCTYPE html>
{%- endblock %}

{%- macro left_sidebar() %}
    {%- if render_sidebar %}
    <div class="{{ bs_span_prefix }}2">
      <div id="sidebar" class="bs-sidenav" role="complementary">
        {%- for sidebartemplate in sidebars %}
          {%- include sidebartemplate %}
        {%- endfor %}
      </div>
    </div>
    {%- endif %}
{%- endmacro %}

{%- macro right_sidebar() %}
    {%- if render_sidebar %}
    <div class="{{ bs_span_prefix }}2" id="localtoc-scrollspy">
    </div>
    {%- endif %}
{%- endmacro %}

{%- macro localtoc_scrollspy() %}
<script type="text/javascript">
(function ($) {
    $('#localtoc-scrollspy').DynamicScrollSpy({
      genIDs: true,
      startingID: '#main-content',
      testing: false,
      ulClassNames: 'hidden-print page-nav',
      offset: 120
    });
}(window.$jqTheme || window.jQuery));
</script>
{%- endmacro %}

{%- block extrahead %}
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
{% endblock %}

{# Silence the sidebars, relbars #}
{% block header %}{% endblock %}
{% block relbar1 %}{% endblock %}
{% block relbar2 %}{% endblock %}
{% block sidebarsourcelink %}{% endblock %}

{%- block content %}
{% include "navbar-cdap.html" %}
<div class="main-container container">
  <div class="row">
    {%- block sidebar1 %}{{ left_sidebar() }}{% endblock %}
    <div class="{{ bs_span_prefix }}{{ bs_content_width }} content" id="main-content">
      {% block body %}{% endblock %}
    </div>
    {% block sidebar2 %}{{ right_sidebar() }}{% endblock %}
  </div>
</div>
{{ localtoc_scrollspy() }}
{%- endblock %}

{%- block footer %}
{#  Code to check relations, controlled by setting in the field list at the top :hide-relations: true #}
{%- set hiderel = '' %}
{%- set hiderel_key = 'hide-relations' %}
{%- if meta is defined %}
    {%- if hiderel_key in meta %}
        {%- set hiderel = meta[hiderel_key] %}
    {%- endif %}
{%- endif %}
<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="{{ bs_span_prefix }}2 footer-left">
        {%- if not hiderel %}
        {%- if prev and prev.title|striptags|e != '&lt;no title&gt;' %}
        <a title="{{ prev.title|striptags|e }}" href="{{ prev.link|e }}" />Previous</a>
        {%- else %}
        &mdash;
        {%- endif %}
        {%- endif %}
      </div>
      <div class="{{ bs_span_prefix }}8 footer-center">
{%- set master_url_root = pathto(master_doc, 1) %}
{%- set zip_archive = "cdap-docs-" ~ release ~ "-web.zip" %}
<a class="footer-tab-link" href="{{ master_url_root + '/../reference.html' }}">Copyright</a> &copy; {% trans copyright=copyright|e %}{{ copyright }}{% endtrans %}
&bull; Download an <a class="footer-tab-link" href="http://docs.cask.co/cdap/{{ release }}/{{ zip_archive }}" rel="nofollow">archive of the documentation</a>
      </div>
      <div class="{{ bs_span_prefix }}2 footer-right">
        {%- if not hiderel %}
        {%- if next and next.title|striptags|e != '&lt;no title&gt;' %}
        <a title="{{ next.title|striptags|e }}" href="{{ next.link|e }}" />Next</a>
        {%- else %}
        &mdash;
        {%- endif %}
        {%- endif %}
      </div>
    </div>
  </div>
</footer>
{%- endblock %}
