{#
    layout.html: extended for CDAP-bootstrap theme
    Assumes using Bootstrap version 3 or higher
#}
{% extends "basic/layout.html" %}

{% set bootstrap_version = "3.3.6" %}
{% set bs_span_prefix = "col-md-" %}

{% set theme_css_files = [
    '_static/bootstrap-' + bootstrap_version + '/css/bootstrap.min.css',
    '_static/bootstrap-' + bootstrap_version + '/css/bootstrap-theme.min.css',
    '_static/bootstrap-sphinx.css',
    '_static/cdap-dynamicscrollspy/cdap-dynamicscrollspy.css'
  ]
%}

{% if not theme_cdap_bootstrap_custom_css %}
  {% set theme_cdap_bootstrap_custom_css = [] %}
{% endif %}

{% set css_files = css_files + theme_css_files + theme_cdap_bootstrap_custom_css %}

{% set script_files = script_files + [
    '_static/js/jquery-1.11.0.min.js',
    '_static/js/jquery-fix.js',
    '_static/bootstrap-' + bootstrap_version + '/js/bootstrap.min.js',
    '_static/bootstrap-sphinx.js',
    '_static/cdap-dynamicscrollspy/cdap-dynamicscrollspy.js'
  ]
%}

{%- set render_sidebar = (not embedded) and (not theme_nosidebar|tobool) and sidebars %}

<!--
{%- set bs_content_width = render_sidebar and "9" or "12"%}
 -->
{%- set bs_content_width = render_sidebar and "8" or "12"%}

{%- block doctype -%}
<!DOCTYPE html>
{%- endblock %}

{# Sidebar: Rework into our Bootstrap nav section. #}

{% macro nav_bar() %}
{% include "navbar.html" %}
{% endmacro %}

{%- macro left_sidebar() %}
    {%- if render_sidebar %}
    <div class="{{ bs_span_prefix }}2">
      <div id="sidebar" class="bs-sidenav" role="complementary">
        {%- for sidebartemplate in sidebars %}
          {%- include sidebartemplate %}
        {%- endfor %}
      </div>
    </div>
    {%- endif %}
{%- endmacro %}

{%- macro right_sidebar() %}
    {%- if render_sidebar %}
    <div class="{{ bs_span_prefix }}2" id="localtoc-scrollspy">
    </div>
    {%- endif %}
{%- endmacro %}

{%- macro localtoc_scrollspy() %}
<script type="text/javascript">
(function ($) {
    $('#localtoc-scrollspy').DynamicScrollSpy({
      genIDs: true,
      testing: false,
      startingID: '#main-content'
    });
}(window.$jqTheme || window.jQuery));
</script>
{%- endmacro %}

{%- block extrahead %}
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
{% endblock %}

{# Silence the sidebars, relbars #}
{% block header %}{% endblock %}
{% block relbar1 %}{% endblock %}
{% block relbar2 %}{% endblock %}
{% block sidebarsourcelink %}{% endblock %}

{%- block content %}
{{ nav_bar() }}
<div class="container">
  <div class="row">
    {%- block sidebar1 %}{{ left_sidebar() }}{% endblock %}
    <div class="{{ bs_span_prefix }}{{ bs_content_width }} content" id="main-content">
      {% block body %}{% endblock %}
    </div>
    {% block sidebar2 %}{{ right_sidebar() }}{% endblock %}
  </div>
</div>
{{ localtoc_scrollspy() }}
{%- endblock %}

{%- block footer %}
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      {% if theme_source_link_position == "footer" %}
        <br/>
        {% include "sourcelink.html" %}
      {% endif %}
    </p>
    <p>
    {%- if show_copyright %}
      {%- if hasdoc('copyright') %}
        {% trans path=pathto('copyright'), copyright=copyright|e %}&copy; <a href="{{ path }}">Copyright</a> {{ copyright }}.{% endtrans %}<br/>
      {%- else %}
        {% trans copyright=copyright|e %}&copy; Copyright {{ copyright }}.{% endtrans %}<br/>
      {%- endif %}
    {%- endif %}
    {%- if last_updated %}
      {% trans last_updated=last_updated|e %}Last updated on {{ last_updated }}.{% endtrans %}<br/>
    {%- endif %}
    {%- if show_sphinx %}
      {% trans sphinx_version=sphinx_version|e %}Created using <a href="http://sphinx-doc.org/">Sphinx</a> {{ sphinx_version }}.{% endtrans %}<br/>
    {%- endif %}
    </p>
  </div>
</footer>
{%- endblock %}
