<!--
  Copyright Â© 2017 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->
<div class="pipeline-scheduler-content">
  <div class="pipeline-scheduler-header">
    <h3 class="modeless-title">
      Schedule for
      <span ng-if="SchedulerCtrl.pipelineName.length > 0">
        "{{SchedulerCtrl.pipelineName}}"
      </span>
    </h3>
    <div class="btn-group">
      <a class="btn" ng-click="SchedulerCtrl.onClose()">
        <span class="fa fa-remove"></span>
      </a>
    </div>
  </div>
  <div class="pipeline-scheduler-body">
    <div class="schedule-content">
      <fieldset ng-disabled="SchedulerCtrl._isDisabled">
        <div class="schedule-types">
          <span class="col-xs-3 schedule-type schedule-type-basic"
                ng-class="{'active': SchedulerCtrl.scheduleType === 'basic'}"
                ng-click="SchedulerCtrl.selectType('basic')">
            Basic
          </span>
          <span class="col-xs-4 schedule-type schedule-type-advanced">
            <span class="separator">
              |
            </span>
            <span ng-class="{'active': SchedulerCtrl.scheduleType === 'advanced'}"
                  ng-click="SchedulerCtrl.selectType('advanced')">
              Advanced
            </span>
          </span>
        </div>
        <div class="schedule-type-content">
          <div ng-if="SchedulerCtrl.scheduleType === 'basic'">
            <div class="form-group">
              <label class="col-xs-3 control-label">
                Pipeline run repeats
              </label>
              <div class="col-xs-4 schedule-values-container">
                <select class="form-control"
                        ng-model="SchedulerCtrl.intervalOptionKey"
                        ng-options="optionKey as optionVal for (optionKey,optionVal) in SchedulerCtrl.INTERVAL_OPTIONS">
                </select>
              </div>
            </div>
            <div class="form-group"
                  ng-class="{'invisible': ['Hourly', 'Daily', 'Weekly', 'Monthly', 'Yearly'].indexOf(SchedulerCtrl.intervalOptionKey) === -1}">
              <label class="col-xs-3 control-label">
                Repeats every
              </label>
              <div class="col-xs-4 schedule-values-container">
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Hourly'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.hourlyOptions.repeatEvery"
                          ng-options="option as option for option in SchedulerCtrl.HOUR_OPTIONS">
                  </select>
                  <span>hour</span>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Daily'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.dailyOptions.repeatEvery"
                          ng-options="option as option for option in SchedulerCtrl.DAY_OF_MONTH_OPTIONS">
                  </select>
                  <span>day</span>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Weekly'">
                  <div class="day-of-week"
                        ng-repeat="(day, selected) in SchedulerCtrl.weeklyOptions.dayOfWeekCheckbox">
                    <label>
                      <input ng-model="SchedulerCtrl.weeklyOptions.dayOfWeekCheckbox[day]"
                              ng-change="SchedulerCtrl.updateSelectedDaysInWeek()"
                              type="checkbox"/>
                      <span>{{ day | cronDayName | getFirstLetter}}</span>
                    </label>
                  </div>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Monthly'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.monthlyOptions.repeatEvery"
                          ng-options="option as (option | cronDayOfMonth) for option in SchedulerCtrl.DAY_OF_MONTH_OPTIONS">
                  </select>
                  <span>day of the month</span>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Yearly'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.yearlyOptions.repeatEvery.month"
                          ng-options="option as (option | cronMonthName) for option in SchedulerCtrl.MONTH_OPTIONS">
                  </select>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.yearlyOptions.repeatEvery.day"
                          ng-options="option as (option | cronDayOfMonth) for option in SchedulerCtrl.DAY_OF_MONTH_OPTIONS">
                  </select>
                </span>
              </div>
            </div>
            <div class="form-group"
                  ng-class="{'invisible': ['Hourly', 'Daily', 'Weekly', 'Monthly', 'Yearly'].indexOf(SchedulerCtrl.intervalOptionKey) === -1}">
              <label class="col-xs-3 control-label">
                Starting at
              </label>
              <div class="col-xs-4 schedule-values-container">
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Hourly'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.hourlyOptions.startingAt"
                          ng-options="option as (option | displayTwoDigitNumber) for option in SchedulerCtrl.MINUTE_OPTIONS">
                  </select>
                  <span>past the hour</span>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Daily'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.dailyOptions.startingAt.hour"
                          ng-options="option as option for option in SchedulerCtrl.HOUR_OPTIONS_CLOCK">
                  </select>
                  <span class="separator"> : </span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.dailyOptions.startingAt.minute"
                          ng-options="option as (option | displayTwoDigitNumber) for option in SchedulerCtrl.MINUTE_OPTIONS">
                  </select>
                  <span>&nbsp;</span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.dailyOptions.startingAt.am_pm"
                          ng-options="option as option for option in SchedulerCtrl.AM_PM_OPTIONS">
                  </select>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Weekly'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.weeklyOptions.startingAt.hour"
                          ng-options="option as option for option in SchedulerCtrl.HOUR_OPTIONS_CLOCK">
                  </select>
                  <span class="separator"> : </span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.weeklyOptions.startingAt.minute"
                          ng-options="option as (option | displayTwoDigitNumber) for option in SchedulerCtrl.MINUTE_OPTIONS">
                  </select>
                  <span>&nbsp;</span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.weeklyOptions.startingAt.am_pm"
                          ng-options="option as option for option in SchedulerCtrl.AM_PM_OPTIONS">
                  </select>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Monthly'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.monthlyOptions.startingAt.hour"
                          ng-options="option as option for option in SchedulerCtrl.HOUR_OPTIONS_CLOCK">
                  </select>
                  <span class="separator"> : </span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.monthlyOptions.startingAt.minute"
                          ng-options="option as (option | displayTwoDigitNumber) for option in SchedulerCtrl.MINUTE_OPTIONS">
                  </select>
                  <span>&nbsp;</span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.monthlyOptions.startingAt.am_pm"
                          ng-options="option as option for option in SchedulerCtrl.AM_PM_OPTIONS">
                  </select>
                </span>
                <span class="schedule-values"
                      ng-if="SchedulerCtrl.intervalOptionKey === 'Yearly'">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.yearlyOptions.startingAt.hour"
                          ng-options="option as option for option in SchedulerCtrl.HOUR_OPTIONS_CLOCK">
                  </select>
                  <span class="separator"> : </span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.yearlyOptions.startingAt.minute"
                          ng-options="option as (option | displayTwoDigitNumber) for option in SchedulerCtrl.MINUTE_OPTIONS">
                  </select>
                  <span>&nbsp;</span>
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.yearlyOptions.startingAt.am_pm"
                          ng-options="option as option for option in SchedulerCtrl.AM_PM_OPTIONS">
                  </select>
                </span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-3 control-label">
                Allow concurrent runs
              </label>
              <div class="col-xs-4 schedule-values-container">
                <div class="radio-inline"">
                  <label>
                    <input type="radio"
                            ng-model="SchedulerCtrl.allowConcurrentRuns"
                            ng-value="true"/>
                     <span>Yes</span>
                  </label>
                  </div>
                  <div class="radio-inline"">
                  <label>
                    <input type="radio"
                            ng-model="SchedulerCtrl.allowConcurrentRuns"
                            ng-value="false"/>
                     <span>No</span>
                  </label>
                  </div>
              </div>
            </div>
            <div class="form-group"
                  ng-class="{'invisible': !SchedulerCtrl.allowConcurrentRuns}">
              <label class="col-xs-3 control-label">
                Max concurrent runs
              </label>
              <div class="col-xs-4 schedule-values-container">
                <select class="form-control small-dropdown"
                        ng-model="SchedulerCtrl.maxConcurrentRuns"
                        ng-options="option as option for option in SchedulerCtrl.MAX_CONCURRENT_RUNS_OPTIONS">
                </select>
              </div>
            </div>
            <div class="form-group summary">
              <label class="col-xs-3 control-label">
                Summary
              </label>
              <div class="col-xs-9 schedule-values-container">
                <div>
                  <span>This pipeline is scheduled to run </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === '5min'">
                    every 5 minutes
                  </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === '10min'">
                    every 10 minutes
                  </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === '30min'">
                    every 30 minutes
                  </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === 'Hourly'">
                    every
                    <span ng-if="SchedulerCtrl.hourlyOptions.repeatEvery === 1">
                      hour,
                    </span>
                    <span ng-if="SchedulerCtrl.hourlyOptions.repeatEvery !== 1">
                      {{ SchedulerCtrl.hourlyOptions.repeatEvery }} hours,
                    </span>
                    <span ng-if="SchedulerCtrl.hourlyOptions.startingAt === 0">
                      on the hour
                    </span>
                    <span ng-if="SchedulerCtrl.hourlyOptions.startingAt !== 0">
                      {{ SchedulerCtrl.hourlyOptions.startingAt | displayTwoDigitNumber }} minutes past the hour
                    </span>
                  </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === 'Daily'">
                    <span ng-if="SchedulerCtrl.dailyOptions.repeatEvery === 1">
                      everyday,
                    </span>
                    <span ng-if="SchedulerCtrl.dailyOptions.repeatEvery !== 1">
                      every {{ SchedulerCtrl.dailyOptions.repeatEvery }} days,
                    </span>
                    <span>
                      at {{ SchedulerCtrl.dailyOptions.startingAt.hour }}:{{ SchedulerCtrl.dailyOptions.startingAt.minute | displayTwoDigitNumber }}{{ SchedulerCtrl.dailyOptions.startingAt.am_pm | lowercase }}
                    </span>
                  </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === 'Weekly'">
                    <span ng-if="SchedulerCtrl.weeklyOptions.repeatEvery.length === 7">
                      everyday,
                    </span>
                    <span ng-if="SchedulerCtrl.weeklyOptions.repeatEvery.length !== 7">
                      every
                      <span ng-repeat="day in SchedulerCtrl.weeklyOptions.repeatEvery">
                        {{ day | cronDayName }},
                      </span>
                    </span>
                    <span>
                      at {{ SchedulerCtrl.weeklyOptions.startingAt.hour }}:{{ SchedulerCtrl.weeklyOptions.startingAt.minute | displayTwoDigitNumber }}{{ SchedulerCtrl.weeklyOptions.startingAt.am_pm | lowercase }}
                    </span>
                  </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === 'Monthly'">
                    <span>
                      every {{ SchedulerCtrl.monthlyOptions.repeatEvery | cronDayOfMonth }} day of the month,
                    </span>
                    <span>
                      at {{ SchedulerCtrl.monthlyOptions.startingAt.hour }}:{{ SchedulerCtrl.monthlyOptions.startingAt.minute | displayTwoDigitNumber }}{{ SchedulerCtrl.monthlyOptions.startingAt.am_pm | lowercase }}
                    </span>
                  </span>
                  <span ng-if="SchedulerCtrl.intervalOptionKey === 'Yearly'">
                    <span>
                      every year on {{ SchedulerCtrl.yearlyOptions.repeatEvery.month | cronMonthName }} {{ SchedulerCtrl.yearlyOptions.repeatEvery.day | cronDayOfMonth }},
                    </span>
                    <span>
                      at {{ SchedulerCtrl.yearlyOptions.startingAt.hour }}:{{ SchedulerCtrl.yearlyOptions.startingAt.minute | displayTwoDigitNumber }}{{ SchedulerCtrl.yearlyOptions.startingAt.am_pm | lowercase }}
                    </span>
                  </span>
                </div>
                <div>
                  <span>The pipeline </span>
                  <span ng-if="SchedulerCtrl.allowConcurrentRuns">
                    can have {{ SchedulerCtrl.maxConcurrentRuns }} concurrent runs
                  </span>
                  <span ng-if="!SchedulerCtrl.allowConcurrentRuns">
                    cannot have concurrent runs
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div ng-if="SchedulerCtrl.scheduleType === 'advanced'">
            <div class="schedule-advanced-header">
              Schedule this pipeline by using Cron syntax
            </div>
            <div class="schedule-advanced-values">
              <div class="form-group col-xs-2 schedule-advanced-input">
                <label>Min</label>
                <input type="text"
                      ng-model="SchedulerCtrl.advancedScheduleValues.min"
                      class="form-control"
                />
              </div>
              <div class="form-group col-xs-2 schedule-advanced-input">
                <label>Hour</label>
                <input type="text"
                      ng-model="SchedulerCtrl.advancedScheduleValues.hour"
                      class="form-control"
                />
              </div>
              <div class="form-group col-xs-2 schedule-advanced-input">
                <label>Day</label>
                <input type="text"
                      ng-model="SchedulerCtrl.advancedScheduleValues.day"
                      class="form-control"
                />
              </div>
              <div class="form-group col-xs-2 schedule-advanced-input">
                <label>Month</label>
                <input type="text"
                      ng-model="SchedulerCtrl.advancedScheduleValues.month"
                      class="form-control"
                />
              </div>
              <div class="form-group col-xs-3 schedule-advanced-input">
                <label>Day of the Week</label>
                <input type="text"
                      ng-model="SchedulerCtrl.advancedScheduleValues.dayOfWeek"
                      class="form-control"
                />
              </div>
            </div>
            <div class="schedule-common-values">
              <div class="form-group">
                <label class="col-xs-3 control-label">
                  Allow concurrent runs
                </label>
                <div class="col-xs-4 schedule-values-container">
                  <div class="radio-inline"">
                    <label>
                      <input type="radio"
                              ng-model="SchedulerCtrl.allowConcurrentRuns"
                              ng-value="true"/>
                       <span>Yes</span>
                    </label>
                    </div>
                    <div class="radio-inline"">
                    <label>
                      <input type="radio"
                              ng-model="SchedulerCtrl.allowConcurrentRuns"
                              ng-value="false"/>
                       <span>No</span>
                    </label>
                    </div>
                </div>
              </div>
              <div class="form-group"
                    ng-class="{'invisible': !SchedulerCtrl.allowConcurrentRuns}">
                <label class="col-xs-3 control-label">
                  Max concurrent runs
                </label>
                <div class="col-xs-4 schedule-values-container">
                  <select class="form-control small-dropdown"
                          ng-model="SchedulerCtrl.maxConcurrentRuns"
                          ng-options="option as option for option in SchedulerCtrl.MAX_CONCURRENT_RUNS_OPTIONS">
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
      <div class="schedule-navigation">
        <button
          ng-if="SchedulerCtrl._isDisabled"
          class="btn btn-primary start-schedule-btn"
          ng-click="SchedulerCtrl.startSchedule()">
          Start Schedule
        </button>
        <button
          ng-if="!SchedulerCtrl._isDisabled"
          class="btn btn-primary save-schedule-btn"
          ng-click="SchedulerCtrl.saveSchedule()">
          Save Schedule
        </button>
      </div>
    </div>
  </div>
</div>
